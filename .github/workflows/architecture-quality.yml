name: Architecture Quality Gate (DISABLED)

# âš ï¸ DISABLED: This workflow is superseded by ios-ci.yml
# Architecture quality checks are now included in ios-ci.yml
# This workflow is kept for manual runs only via workflow_dispatch

on:
  workflow_dispatch:  # Manual trigger only - no automatic runs

jobs:
  architecture-compliance:
    runs-on: macos-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Make Scripts Executable
        run: |
          chmod +x Scripts/architecture-guard.sh
          chmod +x Scripts/pre-commit-enforcement.sh
          chmod +x Scripts/debt-trend-monitor.sh || true

      - name: Run Architecture Quality Check
        run: |
          echo "ğŸ” Running PayslipMax Architecture Quality Gate..."
          ./Scripts/architecture-guard.sh --ci-mode

      - name: Check Violation Count
        id: violations
        run: |
          violations=$(./Scripts/architecture-guard.sh --count-violations 2>&1 | grep -E '^[0-9]+$' | tail -1 || echo "0")
          echo "violations=$violations" >> $GITHUB_OUTPUT
          echo "Found $violations architectural violations"

      - name: Generate Detailed Compliance Report
        run: |
          echo "ğŸ“Š Generating Architecture Compliance Report..."
          ./Scripts/architecture-guard.sh --report > architecture-report.md || touch architecture-report.md

      - name: Upload Architecture Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: architecture-report-${{ github.sha }}
          path: architecture-report.md
          retention-days: 30

      - name: Fail Build on Violations
        if: steps.violations.outputs.violations != '0'
        run: |
          violations="${{ steps.violations.outputs.violations }}"
          echo "âŒ Build failed: $violations architectural violations detected"
          echo "ğŸ”§ Fix violations before merging:"
          echo "   1. Run './Scripts/architecture-guard.sh --fix-suggestions' for specific guidance"
          echo "   2. Use component extraction patterns from the roadmap"
          echo "   3. Keep all files under 300 lines"
          exit 1

      - name: Success Notification
        if: steps.violations.outputs.violations == '0'
        run: |
          echo "âœ… Architecture Quality Gate Passed!"
          echo "ğŸ† All files comply with 300-line rule"
          echo "ğŸ“ˆ Quality score maintained at 94+/100"
