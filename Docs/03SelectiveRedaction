# Task 3: Selective Redaction Strategy

## Issue
- Sending confused/garbage parsed data to LLM â†’ Poor results
- Sending original unredacted data â†’ Privacy/anonymization concerns
- Current approach: all-or-nothing (either use parser output or skip LLM)
- No middle ground for quality LLM input while preserving privacy

## Solution
Implement selective redaction that:
- Redacts only PII (names, account numbers, addresses)
- Preserves structure and non-PII data (pay codes, amounts, headers)
- Sends cleaner data to LLM for better parsing
- Maintains user privacy while improving accuracy

## Phase-wise Implementation

### Phase 1: PII Identification
- [ ] Define PII categories to redact:
  - Full name
  - Account/service numbers
  - Addresses/locations
  - Phone numbers
  - Email addresses
- [ ] Create `PIIDetector` class with regex patterns
- [ ] Test PII detection on sample payslips
- [ ] Ensure no false positives on pay codes/amounts

### Phase 2: Redaction Engine
- [ ] Create `SelectiveRedactor` class
- [ ] Implement replacement strategy:
  - Names â†’ `***NAME***`
  - Account numbers â†’ `***ACCOUNT***`
  - Locations â†’ `***LOCATION***`
- [ ] Preserve:
  - Pay codes (BPAY, DSOP, etc.)
  - Numerical amounts
  - Dates (month/year only)
  - Section headers and structure
- [ ] Add configurable redaction rules

### Phase 3: LLM Prompt Enhancement
- [ ] Update `LLMPayslipParser` to handle redacted text
- [ ] Modify prompt to explain redaction placeholders
- [ ] Add structured format for partially-parsed data:
  ```
  Known fields:
  - Month: [value]
  - Basic Pay: [value or UNKNOWN]

  Redacted text:
  [text with PII replaced]
  ```
- [ ] Test LLM accuracy with redacted input

### Phase 4: Hybrid Logic Update
- [ ] Modify `HybridPayslipProcessor` to use selective redaction
- [ ] Decision logic:
  - Confidence â‰¥ 90%: No LLM needed
  - Confidence 50-89%: Send redacted text to LLM
  - Confidence < 50%: Send redacted original text
- [ ] Add redaction quality logging

### Phase 5: Preview & User Transparency
- [ ] Create redacted text preview for debugging
- [ ] Add logs showing what was redacted
- [ ] Build foundation for UI preview (Task 5)
- [ ] Test end-to-end with various payslip types
- [ ] Measure LLM accuracy improvement vs privacy preservation

---

Summary
I've analyzed your colleague's selective redaction suggestion and created a comprehensive feasibility report. Here's the quick version:

ðŸŽ¯ Bottom Line: HIGHLY IMPLEMENTABLE (85-95% feasibility)
Good News:

âœ… Phase 1 (PII Identification) is 100% complete - Your existing PayslipAnonymizer already has all the regex patterns needed
âœ… You have a solid foundation with HybridPayslipProcessor and quality-based decision logic
âœ… LLM integration already accepts anonymized text
What Needs Work:

Phase 2 (2-3 hours): Create a new SelectiveRedactor class that preserves pay codes and structure while redacting PII
Phase 3 (1-2 hours): Update LLM prompt to explain redaction placeholders
Phase 4 (3-4 hours): Enhance hybrid processor to send partial regex results + redacted unknown fields
Phase 5 (4-6 hours, optional): UI for showing what was redacted (nice-to-have)
Total Effort: ~10-15 hours for full implementation

Key Challenge: Your current approach is "all-or-nothing" (send everything anonymized OR don't use LLM). The suggestion moves you to a "hybrid input" model where confident regex fields are sent as "known" and uncertain text is selectively redacted.

My Recommendation: Start with Phases 2-3 (quick 3-5 hour implementation), test with real payslips, and only proceed to Phase 4 if you see accuracy improvements.

I've created a detailed analysis document with:

What you already have vs what's missing
Per-phase implementation details
Risk assessment
ROI analysis
Recommended implementation path